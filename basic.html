<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vancouver Neighborhoods Map</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: 'Poppins', sans-serif;
        }
        .map-container {
            display: flex;
        }
        .map {
            flex: 1;
            padding: 10px;
        }
        .info {
            width: 300px;
            padding: 10px;
            border-left: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .path {
            stroke: #fff;
            stroke-width: 1;
            opacity: 0.8;
        }
        .debug {
            stroke: red;
            stroke-width: 2;
            fill: none;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="map-container">
        <div class="map">
            <svg width="1000" height="800"></svg>
        </div>
        <div class="info" id="info-box">
            <h3>Neighborhood Information</h3>
            <p id="neighborhood-name">Hover over a neighborhood to see details.</p>
            <p id="bike-lane-count"></p>
        </div>
    </div>
    <script>
        // Set up the SVG canvas dimensions
        const width = 1000;
        const height = 800;

        // Create the SVG element
        const svg = d3.select("svg")
            .attr("width", width)
            .attr("height", height);

        // Define a projection
        const projection = d3.geoMercator()
            .center([-123.124, 49.247]) // Center on Vancouver
            .scale(220000) // Scale it to zoom in
            .translate([width / 2, height / 2]);

        // Define a path generator
        const path = d3.geoPath()
            .projection(projection);

        // Declare bikeLaneCounts variable globally
        let bikeLaneCounts = {};

        // Define the mouse events
        let mouseOver = function(event, d) {
            d3.selectAll("path")
                .transition()
                .duration(200)
                .style("opacity", 0.5);
            d3.select(this)
                .transition()
                .duration(200)
                .style("opacity", 1);

            // Update the information box
            const neighborhood = d.properties.name;
            const count = bikeLaneCounts[neighborhood] || "No data";
            d3.select("#neighborhood-name").text(neighborhood);
            d3.select("#bike-lane-count").text(`Bike Lanes: ${count}`);
        };

        let mouseLeave = function(d) {
            d3.selectAll("path")
                .transition()
                .duration(200)
                .style("opacity", 0.8);
            d3.select(this)
                .transition()
                .duration(200)
                .style("opacity", 0.8);

            // Clear the information box
            d3.select("#neighborhood-name").text("Hover over a neighborhood to see details.");
            d3.select("#bike-lane-count").text("");
        };

        // Load the GeoJSON data from the file
        d3.json("local-area-boundary.geojson").then(function(geojson) {
            // Load the CSV data
            d3.csv("bike_lanes_count.csv").then(function(data) {
                // Create a map of neighborhood names to bike lane counts
                bikeLaneCounts = {};
                data.forEach(d => {
                    bikeLaneCounts[d.name] = +d.bike_lane_count;
                });

                // Add a color scale
                const colorScale = d3.scaleQuantize()
                    .domain([0, d3.max(Object.values(bikeLaneCounts))])
                    .range(d3.schemeBlues[9]); // 9 color shades from D3

                // Append the GeoJSON data to the SVG
                svg.selectAll("path")
                    .data(geojson.features)
                    .enter().append("path")
                    .attr("d", path)
                    .attr("class", "path")
                    .attr("fill", function(d) {
                        const neighborhood = d.properties.name;
                        const count = bikeLaneCounts[neighborhood];
                        return colorScale(count);
                    })
                    .on("mouseover", mouseOver)
                    .on("mouseleave", mouseLeave);
            }).catch(function(error) {
                console.error("Error loading the CSV data: ", error);
            });
        }).catch(function(error) {
            console.error("Error loading the GeoJSON data: ", error);
        });
    </script>
</body>
</html>
